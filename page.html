<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (samma head som innan) ... -->
  <title>Video Player with Settings</title>
  <style>
    /* Din befintliga CSS (oförändrad) ... */

    /* Ny popup-stil */
    .upgrade-popup {
      position: absolute;
      background-color: #fff;
      color: black;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 10000;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 320px;
      text-align: center;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="editor-content">
    <!-- ... (resten av din HTML är oförändrad) ... -->

    <!-- Knappen: ändrad för att köra handleUpgradeClick istället -->
    <button id="upgrade-video-btn" class="button" onclick="handleUpgradeClick()">Upgrade Your Video</button>

    <!-- Upgrade-alternativ -->
    <div id="upgrade-options">
      <h3>Select resolution to upgrade:</h3>
      <button class="button resolution-btn" onclick="handleResolutionClick('720p')">720p</button>
      <button class="button resolution-btn" onclick="handleResolutionClick('1080p')">1080p</button>
      <button class="button resolution-btn" onclick="handleResolutionClick('1440p')">1440p</button>
      <button class="button resolution-btn" onclick="handleResolutionClick('4K')">4K</button>
    </div>

    <!-- Progress-bar (oförändrad) -->
    <div id="progress-bar">
      <div id="progress-bar-filled"></div>
    </div>
    <div id="progress-text">0% of 100% to complete conversion</div>
  </div>

  <!-- Popup-meddelanden -->
  <div id="upgrade-no-video" class="upgrade-popup" style="display: none;">
    Please apply a video.
  </div>

  <div id="upgrade-warning" class="upgrade-popup" style="display: none;">
    This upgrade is done locally in your browser and may impact video quality. Proceed with caution.
  </div>

  <div id="upgrade-terms" class="upgrade-popup" style="display: none;">
    Upgrading may cause quality loss or increased file size. Accept terms to proceed.<br/><br/>
    <button onclick="acceptUpgradeTerms()">Accept the Terms</button>
    <button onclick="denyUpgradeTerms()">Deny</button>
  </div>

  <div id="upgrade-sufficient" class="upgrade-popup" style="display: none;"></div>

  <!-- Bakgrundsbyte & hemsideknapp (oförändrad) -->
  <button id="change-background-btn" class="button" onclick="toggleBackgroundOptions()">Change Background</button>
  <button id="back-to-home-btn" class="button" onclick="window.location.href='index.html'">Go to Homepage</button>

  <div id="background-options">
    <h3>Choose Theme</h3>
    <button class="option-button" onclick="setLightMode()">Light Mode</button>
    <button class="option-button" onclick="setDarkMode()">Dark Mode</button>
  </div>

  <!-- JavaScript -->
  <script>
    // Din befintliga JavaScript: UI, bakgrund, sliders, etc.

    const backgroundOptions = document.getElementById("background-options");
    const upgradeOptions = document.getElementById("upgrade-options");

    function toggleBackgroundOptions() {
      backgroundOptions.style.display = backgroundOptions.style.display === "block" ? "none" : "block";
    }

    function setLightMode() {
      document.body.classList.remove("dark-mode");
    }

    function setDarkMode() {
      document.body.classList.add("dark-mode");
    }

    window.addEventListener("click", function (event) {
      if (!event.target.closest("#change-background-btn") && !event.target.closest("#background-options")) {
        backgroundOptions.style.display = "none";
      }
      if (!event.target.closest("#upgrade-video-btn") && !event.target.closest("#upgrade-options")) {
        upgradeOptions.style.display = "none";
      }
    });

    function updateVolumePercentage(type) {
      const slider = document.getElementById(`${type}-volume`);
      const percent = document.getElementById(`${type}-volume-percent`);
      percent.textContent = `${slider.value}%`;
    }

    function triggerFileInput() {
      document.getElementById("file-input").click();
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        document.getElementById("file-name").textContent = file.name;
      }
    }

    function convertToMP4() {
      alert("Pretending to convert to MP4...");
    }

    // -----------------------
    // NYA FUNKTIONER
    // -----------------------

    let upgradeAccepted = false;
    let selectedUpgradeResolution = null;

    function handleUpgradeClick() {
      const fileNameText = document.getElementById("file-name").textContent;
      if (fileNameText === "No file selected") {
        showUpgradePopup("upgrade-no-video");
        return;
      }

      showUpgradePopup("upgrade-warning");

      setTimeout(() => {
        document.getElementById("upgrade-options").style.display = "block";
      }, 1500);
    }

    function handleResolutionClick(resolution) {
      selectedUpgradeResolution = resolution;

      if (!upgradeAccepted) {
        showUpgradePopup("upgrade-terms");
        return;
      }

      const currentRes = getCurrentVideoResolution();
      const resRank = { "720p": 1, "1080p": 2, "1440p": 3, "4K": 4 };

      if (resRank[currentRes] >= resRank[resolution]) {
        showUpgradePopup("upgrade-sufficient", `Your video is already sufficient. It thus already has ${resolution}.`);
        return;
      }

      startUpgradeProgress();
    }

    function acceptUpgradeTerms() {
      upgradeAccepted = true;
      hideUpgradePopup("upgrade-terms");
      if (selectedUpgradeResolution) {
        handleResolutionClick(selectedUpgradeResolution);
      }
    }

    function denyUpgradeTerms() {
      upgradeAccepted = false;
      hideUpgradePopup("upgrade-terms");
    }

    function getCurrentVideoResolution() {
      const video = document.getElementById("video-player");
      const h = video.videoHeight;
      if (h >= 2160) return "4K";
      if (h >= 1440) return "1440p";
      if (h >= 1080) return "1080p";
      if (h >= 720) return "720p";
      return "480p";
    }

    function startUpgradeProgress() {
      const bar = document.getElementById("progress-bar");
      const filled = document.getElementById("progress-bar-filled");
      const text = document.getElementById("progress-text");

      bar.style.display = "block";
      text.style.display = "block";

      let progress = 0;
      filled.style.width = "0%";
      text.textContent = "0% of 100% to complete upgrade";

      const interval = setInterval(() => {
        if (progress >= 100) {
          clearInterval(interval);
          text.textContent = "Upgrade complete!";
        } else {
          progress += 5;
          filled.style.width = progress + "%";
          text.textContent = `${progress}% of 100% to complete upgrade`;
        }
      }, 300);
    }

    function showUpgradePopup(id, msg = null) {
      const el = document.getElementById(id);
      if (msg) el.innerText = msg;
      el.style.display = "block";
      setTimeout(() => {
        el.style.display = "none";
      }, 4000);
    }

    function hideUpgradePopup(id) {
      document.getElementById(id).style.display = "none";
    }
  </script>
</body>
</html>
