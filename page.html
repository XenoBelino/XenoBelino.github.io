<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Video Player with Settings</title>
  <style>
    /* ... (samma CSS som tidigare, ingen ändring krävs) ... */
  </style>
</head>
<body>
  <div class="editor-content" id="editor-content">
    <div class="intro-section">
      <h1>Välkommen till Video- och Ljudredigeraren!</h1>
      <p>Här kan du ladda upp en video, ändra volyminställningar och justera bakgrunden.</p>
    </div>

    <div class="video-container">
      <video id="video-player" controls>
        <source id="video-source" src="assets/videos/sample.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>

    <div id="file-name">No file selected</div>
    <button id="browse-btn" class="browse-button" onclick="triggerFileInput()">Browse Files</button>
    <input type="file" id="file-input" style="display:none;" onchange="handleFileSelect(event)" />

    <button id="convert-btn" class="button" onclick="convertToMP4()">Convert to MP4</button>
    <button id="upgrade-video-btn" class="button" onclick="onUpgradeClick()">Upgrade Your Video</button>

    <div class="volume-slider-container">
      <!-- Volym sliders (oförändrade) -->
    </div>

    <div id="progress-bar"><div id="progress-bar-filled"></div></div>
    <div id="progress-text">0% of 100% to complete conversion</div>
  </div>

  <button id="change-background-btn" class="button" onclick="toggleBackgroundOptions()">Change Background</button>
  <button id="back-to-home-btn" class="button" onclick="window.location.href='index.html'">Go to Homepage</button>

  <div id="background-options">
    <h3>Choose Theme</h3>
    <button class="option-button" onclick="setLightMode()">Light Mode</button>
    <button class="option-button" onclick="setDarkMode()">Dark Mode</button>
  </div>

  <!-- Popups -->
  <div id="popup-no-video" class="popup"><p>Apply a video before upgrading.</p><div class="popup-buttons"><button onclick="closePopup('popup-no-video')">OK</button></div></div>
  <div id="popup-warning" class="popup"><p>⚠️ This upgrade does not use a server. It may stress your device. Proceed with caution.</p><div class="popup-buttons"><button onclick="proceedToResolution()">OK</button><button onclick="closePopup('popup-warning')">Cancel</button></div></div>
  <div id="popup-terms" class="popup"><p id="terms-text">Are you sure you want to upgrade your video?</p><div class="popup-buttons"><button onclick="acceptTerms()">Accept the Terms</button><button onclick="denyTerms()">Deny</button></div></div>
  <div id="popup-sufficient" class="popup"><p id="sufficient-text">Your video is already sufficient.</p><div class="popup-buttons"><button onclick="closePopup('popup-sufficient')">OK</button></div></div>

  <div id="upgrade-options" style="display:none;">
    <h3>Select Resolution</h3>
    <button class="resolution-btn" onclick="startUpgradeProcess('480p')">480p</button>
    <button class="resolution-btn" onclick="startUpgradeProcess('720p')">720p</button>
    <button class="resolution-btn" onclick="startUpgradeProcess('1080p')">1080p</button>
    <button class="resolution-btn" onclick="startUpgradeProcess('1440p')">1440p</button>
    <button class="resolution-btn" onclick="startUpgradeProcess('2160p')">2160p</button>
  </div>

  <script>
    // ... Alla dina befintliga funktioner ...

    function onUpgradeClick() {
      const videoPlayer = document.getElementById("video-player");
      const videoSource = document.getElementById("video-source").src;
      if (!videoSource || videoSource === "" || videoSource.includes("sample.mp4")) {
        openPopup("popup-no-video");
        return;
      }

      // Vänta tills videon har metadata innan vi kontrollerar upplösning
      if (videoPlayer.readyState >= 1) {
        checkVideoResolution(videoPlayer);
      } else {
        videoPlayer.addEventListener("loadedmetadata", function handler() {
          videoPlayer.removeEventListener("loadedmetadata", handler);
          checkVideoResolution(videoPlayer);
        });
      }
    }

    function checkVideoResolution(video) {
      const minResolution = 480;
      const width = video.videoWidth;
      const height = video.videoHeight;

      console.log("Video resolution:", width, "x", height);

      if (width < minResolution || height < minResolution) {
        openPopup("popup-sufficient");
      } else {
        openPopup("popup-warning");
      }
    }

    function openPopup(id) {
      document.getElementById(id).style.display = "block";
    }

    function closePopup(id) {
      document.getElementById(id).style.display = "none";
    }

    function proceedToResolution() {
      closePopup("popup-warning");
      openUpgradeOptions();
    }

    function openUpgradeOptions() {
      document.getElementById("upgrade-options").style.display = "block";
    }

    function startUpgradeProcess(resolution) {
      document.getElementById("upgrade-options").style.display = "none";
      alert(`Video uppgraderas till ${resolution}. Denna process kan ta tid.`);
    }

    // Resterande funktioner (setLightMode, setDarkMode, triggerFileInput etc.) förblir oförändrade
  </script>
</body>
</html>
