<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Video Player with Settings</title>
    <link rel="stylesheet" href="styles.css"> <!-- LÃ¤nka till styles.css -->
</head>
<body>
    <div class="editor-content">
        <!-- Video Player Container -->
        <div class="video-container">
            <video id="video-player" controls>
                <source src="assets/videos/sample.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>

        <!-- File Selection and File Info -->
        <button id="browse-btn" class="browse-button">Browse Files</button>
        <input type="file" id="file-input" style="display:none;" onchange="handleFileSelect(event)">
        <div id="file-name">No file selected</div>

        <!-- Buttons for Background Change and Volumes -->
        <button id="change-background-btn" class="button">Change Background</button>
        <button id="save-btn" class="button">Save Settings</button>

        <!-- Volume Controls -->
        <div class="volume-slider-container">
            <div>
                <label for="original-volume">Original Volume:</label>
                <input type="range" id="original-volume" class="volume-slider" min="0" max="100" value="50" onchange="updateVolumePercentage('original')">
                <span id="original-volume-percent" class="volume-percentage">50%</span>
                <span id="original-volume-icon">ðŸ”‰</span>
            </div>
            <div>
                <label for="corrupted-volume">Corrupted Volume:</label>
                <input type="range" id="corrupted-volume" class="volume-slider" min="0" max="100" value="50" onchange="updateVolumePercentage('corrupted')">
                <span id="corrupted-volume-percent" class="volume-percentage">50%</span>
                <span id="corrupted-volume-icon">ðŸ”‰</span>
            </div>
            <div>
                <label for="music-volume">Music Volume:</label>
                <input type="range" id="music-volume" class="volume-slider" min="0" max="100" value="50" onchange="updateVolumePercentage('music')">
                <span id="music-volume-percent" class="volume-percentage">50%</span>
                <span id="music-volume-icon">ðŸ”‰</span>
            </div>
            <div>
                <label for="final-volume">Final Volume:</label>
                <input type="range" id="final-volume" class="volume-slider" min="0" max="100" value="50" onchange="updateVolumePercentage('final')">
                <span id="final-volume-percent" class="volume-percentage">50%</span>
                <span id="final-volume-icon">ðŸ”‰</span>
            </div>
        </div>

        <!-- Buttons for Navigation -->
        <button id="back-to-home-btn" class="button back-button">Back to Home Page</button>
        <button id="go-to-page-btn" class="button back-button">Go to Page</button>
    </div>

    <script src="scripts.js" defer></script> <!-- LÃ¤nka till scripts.js -->

    <script>
        // LÃ¤gg till en event listener fÃ¶r knappen "Back to Home Page"
        document.getElementById('back-to-home-btn').addEventListener('click', function() {
            window.location.href = 'index.html'; // Omdirigera till index.html
        });

        // LÃ¤gg till event-lyssnare fÃ¶r "Browse Files"-knappen och andra funktioner
        document.getElementById('file-input').addEventListener('change', handleFileSelect);

        document.getElementById('convert-btn').addEventListener('click', function() {
            const fileInput = document.getElementById('file-input');
            if (!fileInput.files.length) {
                alert("VÃ¤nligen vÃ¤lj en fil fÃ¶rst!");
                return;
            }

            const file = fileInput.files[0];
            const fileInfo = document.getElementById('file-name');
            const videoPlayer = document.getElementById('video-player');
            const videoSource = videoPlayer.querySelector('source');
            const reader = new FileReader();

            // Visa progress-bar och bÃ¶rja konvertering
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('progress-bar').value = 0;
            document.getElementById('progress-percent').textContent = '0%';

            reader.onload = function(event) {
                const inputFileData = event.target.result;
                const ffmpeg = FFmpeg.createFFmpeg({ log: true, progress: (progress) => {
                    if (progress && progress.percent !== undefined) {
                        document.getElementById('progress-bar').value = progress.percent;
                        document.getElementById('progress-percent').textContent = `${Math.round(progress.percent)}%`;
                    }
                } });

                // Ladda FFmpeg
                ffmpeg.load().then(() => {
                    // Skriv filen till FFmpeg:s virtuella filsystem
                    ffmpeg.FS('writeFile', file.name, new Uint8Array(inputFileData));

                    // KÃ¶r FFmpeg fÃ¶r att konvertera video (FLV till MP4)
                    ffmpeg.run('-i', file.name, 'output.mp4').then(() => {
                        const data = ffmpeg.FS('readFile', 'output.mp4');
                        const convertedBlob = new Blob([data.buffer], { type: 'video/mp4' });
                        const convertedUrl = URL.createObjectURL(convertedBlob);

                        // Uppdatera videospelaren med den konverterade videon
                        videoSource.src = convertedUrl;
                        videoPlayer.load();

                        // NÃ¤r konverteringen Ã¤r klar, uppdatera progress och ladda ned filen
                        document.getElementById('progress-bar').value = 100;
                        document.getElementById('progress-percent').textContent = '100%';

                        // Skapa en nedladdningslÃ¤nk fÃ¶r den konverterade videon
                        const downloadLink = document.createElement('a');
                        downloadLink.href = convertedUrl;
                        downloadLink.download = 'converted_video.mp4';
                        downloadLink.click();

                        // DÃ¶lj progress efter en kort stund
                        setTimeout(() => {
                            document.getElementById('progress-container').style.display = 'none';
                        }, 500);
                    });
                });
            };

            reader.readAsArrayBuffer(file);
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            const fileInfo = document.getElementById('file-name');
            const videoPlayer = document.getElementById('video-player');
            const videoSource = videoPlayer.querySelector('source');

            if (file) {
                const fileURL = URL.createObjectURL(file);
                videoSource.src = fileURL;
                videoPlayer.load();
                fileInfo.textContent = `Vald fil: ${file.name}`;
            } else {
                fileInfo.textContent = 'Ingen fil vald';
            }
        }
    </script>
</body>
</html>
